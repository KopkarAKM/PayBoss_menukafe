<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesan Menu - Payboss Cafe</title>
    <style>
        body {
            box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #D2B48C 100%); min-height: 100%;
        }
        html { height: 100%; }
        .nav-bar {
            background: rgba(62, 39, 35, 0.95); padding: 15px 20px; display: flex;
            justify-content: space-between; align-items: center; position: sticky;
            top: 0; z-index: 1000; backdrop-filter: blur(10px);
        }
        .nav-brand { color: #D2B48C; font-size: 1.5rem; font-weight: bold; text-decoration: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .page { background: rgba(255, 255, 255, 0.95); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; margin-bottom: 20px; }
        .page-header { background: linear-gradient(135deg, #3E2723 0%, #5D4037 100%); color: white; padding: 30px; text-align: center; }
        .page-header h1 { margin: 0 0 10px 0; font-size: 2.5rem; font-weight: bold; }
        .page-header p { margin: 0; opacity: 0.9; font-size: 1.1rem; }
        .tabs { display: flex; background: #3E2723; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .tab-button {
            flex: none; padding: 18px 20px; background: none; border: none; color: #D2B48C; font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; min-width: 140px; text-align: center;
        }
        .tab-button:hover { background: rgba(210, 180, 140, 0.1); color: #FFFFFF; }
        .tab-button.active { background: #8B4513; color: #FFFFFF; box-shadow: inset 0 -3px 0 #D2B48C; }
        .tab-content { display: none; padding: 25px; animation: fadeIn 0.3s ease-in; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .category-title { font-size: 2rem; color: #3E2723; margin-bottom: 25px; text-align: center; font-weight: bold; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .menu-item {
            background: #FFFFFF; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease; border-left: 5px solid #8B4513; position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }
        .menu-item-content { flex-grow: 1; }
        .menu-item::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, #8B4513, #D2B48C);
        }
        .menu-item:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); border-left-color: #D2B48C; }
        .item-name { font-size: 1.3rem; font-weight: bold; color: #3E2723; margin-bottom: 8px; }
        .item-description { color: #666; font-size: 0.95rem; margin-bottom: 12px; line-height: 1.5; }
        .item-variants { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 12px; font-size: 0.9rem; color: #555; }
        .item-price { font-size: 1.4rem; font-weight: bold; color: #8B4513; margin-bottom: 15px; }
        .order-btn {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; border: none;
            padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;
            width: 100%; transition: all 0.3s ease; font-size: 1rem; margin-top: auto;
        }
        .order-btn:hover { background: linear-gradient(135deg, #A0522D 0%, #8B4513 100%); transform: translateY(-2px); }
        .notification {
            position: fixed; top: 20px; right: 20px; background: #8B4513; color: white; padding: 15px 20px;
            border-radius: 8px; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-weight: bold;
            transform: translateX(calc(100% + 30px)); transition: transform 0.4s ease-in-out;
        }
        .notification.show { transform: translateX(0); }
        .cart-fab {
            position: fixed; bottom: 30px; right: 30px; background: #3E2723; color: white; width: 60px;
            height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; z-index: 1001; transition: transform 0.2s ease;
        }
        .cart-fab:hover { transform: scale(1.1); }
        .cart-badge {
            position: absolute; top: -5px; right: -5px; background: #D32F2F; color: white; font-size: 12px;
            font-weight: bold; width: 24px; height: 24px; border-radius: 50%; display: flex;
            justify-content: center; align-items: center;
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 0;
            visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content {
            background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;
            max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; color: #3E2723; }
        .modal-close { font-size: 24px; cursor: pointer; color: #888; border: none; background: none;}
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .cart-item { display: flex; align-items: center; margin-bottom: 15px; }
        .cart-item-details { flex-grow: 1; }
        .cart-item-actions { display: flex; align-items: center; }
        .quantity-btn { background: #eee; border: 1px solid #ccc; padding: 5px 10px; cursor: pointer; }
        .item-quantity { padding: 0 10px; }
        .remove-btn { color: #D32F2F; margin-left: 15px; cursor: pointer; border: none; background: none; font-size: 16px; }
        .cart-total { text-align: right; font-size: 1.1rem; line-height: 1.6; font-weight: 500; margin-top: 20px; }
        .cart-total strong { font-size: 1.3rem; color: #3E2723;}
        .payment-options button { width: 100%; padding: 15px; margin-bottom: 10px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; }
        #qris-image { max-width: 100%; border-radius: 8px; }
        .whatsapp-btn { background: #25D366; color: white; display: block; text-align: center; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: bold; }
        @media (max-width: 768px) {
            .nav-bar { flex-direction: column; gap: 10px; }
            .container { padding: 10px; }
            .page-header h1 { font-size: 2rem; }
            .menu-grid { grid-template-columns: 1fr; }
        }
        .loading {
            display: inline-block; width: 16px; height: 16px; border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; vertical-align: middle; margin-right: 5px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <a href="#" class="nav-brand">‚òï Pesan Menu Payboss Cafe</a>
    </nav>
    <div class="container">
        <div id="menu-page" class="page active">
            <div class="page-header">
                <h1>üìã Menu Kami</h1>
                <p>Silakan pilih menu favorit Anda</p>
            </div>
            <div class="tabs">
                <button class="tab-button active" data-tab="snacks">üçü Makanan Ringan</button>
                <button class="tab-button" data-tab="pastry">ü•ê Roti & Manis</button>
                <button class="tab-button" data-tab="main">üçõ Makanan Berat</button>
                <button class="tab-button" data-tab="coffee">‚òï Kopi</button>
                <button class="tab-button" data-tab="non-coffee">ü•§ Non-Kopi</button>
            </div>
            <div id="snacks" class="tab-content active"><h2 class="category-title">üçü Makanan Ringan</h2><div class="menu-grid" id="snacks-grid"></div></div>
            <div id="pastry" class="tab-content"><h2 class="category-title">ü•ê Roti & Manis</h2><div class="menu-grid" id="pastry-grid"></div></div>
            <div id="main" class="tab-content"><h2 class="category-title">üçõ Makanan Berat</h2><div class="menu-grid" id="main-grid"></div></div>
            <div id="coffee" class="tab-content"><h2 class="category-title">‚òï Kopi</h2><div class="menu-grid" id="coffee-grid"></div></div>
            <div id="non-coffee" class="tab-content"><h2 class="category-title">ü•§ Non-Kopi</h2><div class="menu-grid" id="non-coffee-grid"></div></div>
        </div>
    </div>
    
    <div class="cart-fab" id="cart-fab">
        üõí
        <span class="cart-badge" id="cart-badge">0</span>
    </div>

    <div class="modal-overlay" id="cart-modal"> <div class="modal-content"> <div class="modal-header"> <h2>Keranjang Anda</h2> <button class="modal-close">&times;</button> </div> <div id="cart-items"></div> <div class="cart-total" id="cart-total"></div> <hr> <div class="form-group"> <label for="customer-name">Nama Anda</label> <input type="text" id="customer-name" placeholder="Masukkan nama Anda"> </div> <div class="form-group"> <label for="table-number">Nomor Meja</label> <input type="number" id="table-number" placeholder="Masukkan nomor meja"> </div> <button class="order-btn" id="checkout-btn">Lanjutkan ke Pembayaran</button> </div> </div>
    <div class="modal-overlay" id="payment-modal"> <div class="modal-content"> <div class="modal-header"> <h2>Pilih Metode Pembayaran</h2> <button class="modal-close">&times;</button> </div> <div class="payment-options"> <button id="pay-cash-btn">Bayar di Kasir (Cash)</button> <button id="pay-qris-btn">Bayar dengan QRIS</button> </div> </div> </div>
    <div class="modal-overlay" id="qris-modal"> <div class="modal-content" style="text-align: center;"> <div class="modal-header"> <h2>Scan untuk Membayar</h2> <button class="modal-close">&times;</button> </div> <img id="qris-image" src="https://i.imgur.com/Pc4W6zN.jpeg" alt="QRIS Code"> <p style="margin-top: 15px;">Setelah membayar, klik tombol di bawah untuk mengirim bukti ke kasir via WhatsApp.</p> <button class="order-btn" id="confirm-qris-payment-btn">Saya Sudah Bayar & Kirim Bukti</button> </div> </div>
    <div class="modal-overlay" id="success-modal"> <div class="modal-content" style="text-align: center;"> <div class="modal-header"> <h2>Pesanan Diterima!</h2> <button class="modal-close">&times;</button> </div> <div id="success-message"></div> <a href="#" id="whatsapp-link" class="whatsapp-btn" target="_blank" style="display: none; margin-top: 20px;">Kirim Pesanan ke Kasir</a> </div> </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyB0nHqdAw_dV9pHcQ_cSnWtNsn4CwwwUNc",
          authDomain: "payboss-cafe-system.firebaseapp.com",
          projectId: "payboss-cafe-system",
          storageBucket: "payboss-cafe-system.appspot.com",
          messagingSenderId: "570523503793",
          appId: "1:570523503793:web:0a7ba7ce751eb95a3f6690",
          measurementId: "G-H1NJ369HE9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let cart = [];
        let menuCache = [];

        onSnapshot(collection(db, 'menu'), (snapshot) => {
            menuCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderAllMenus();
        });

        function renderAllMenus() {
            document.querySelectorAll('.menu-grid').forEach(grid => grid.innerHTML = '');
            menuCache.forEach(item => {
                const grid = document.getElementById(`${item.category}-grid`);
                if (grid) grid.appendChild(createMenuCard(item));
            });
        }

        function createMenuCard(item) {
            const card = document.createElement('div');
            card.className = 'menu-item';
            const variantsHtml = item.variants ? `<div class="item-variants"><strong>Varian:</strong> ${item.variants}</div>` : '';
            card.innerHTML = `
                <div class="menu-item-content">
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.description}</div>
                    ${variantsHtml}
                    <div class="item-price">Rp ${item.price.toLocaleString('id-ID')}</div>
                </div>
                <button class="order-btn" data-id="${item.id}">+ Keranjang</button>
            `;
            return card;
        }

        function renderCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalEl = document.getElementById('cart-total');
            cartItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p>Keranjang Anda masih kosong.</p>';
                cartTotalEl.innerHTML = '';
            } else {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
                const tax = subtotal * 0.10;
                const grandTotal = subtotal + tax;

                cart.forEach(item => {
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'cart-item';
                    cartItemEl.innerHTML = `
                        <div class="cart-item-details">
                            <strong>${item.name}</strong> (x${item.qty})<br>
                            Rp ${(item.price * item.qty).toLocaleString('id-ID')}
                        </div>
                        <div class="cart-item-actions">
                            <button class="quantity-btn" data-id="${item.id}" data-action="decrease">-</button>
                            <span class="item-quantity">${item.qty}</span>
                            <button class="quantity-btn" data-id="${item.id}" data-action="increase">+</button>
                            <button class="remove-btn" data-id="${item.id}">&times;</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemEl);
                });

                cartTotalEl.innerHTML = `
                    Subtotal: Rp ${subtotal.toLocaleString('id-ID')}<br>
                    Pajak (10%): Rp ${tax.toLocaleString('id-ID')}<br>
                    <strong>Total: Rp ${grandTotal.toLocaleString('id-ID')}</strong>
                `;
            }
            document.getElementById('cart-badge').textContent = cart.reduce((sum, item) => sum + item.qty, 0);
        }

        function addToCart(itemId) {
            const itemInCart = cart.find(item => item.id === itemId);
            if (itemInCart) {
                itemInCart.qty++;
            } else {
                const itemFromMenu = menuCache.find(item => item.id === itemId);
                cart.push({ ...itemFromMenu, qty: 1 });
            }
            showNotification(`${cart.find(i=>i.id===itemId).name} ditambahkan.`);
            renderCart();
        }

        function updateCartQuantity(itemId, action) {
            const itemInCart = cart.find(item => item.id === itemId);
            if (!itemInCart) return;

            if (action === 'increase') itemInCart.qty++;
            else if (action === 'decrease' && itemInCart.qty > 1) itemInCart.qty--;
            else cart = cart.filter(item => item.id !== itemId);
            
            renderCart();
        }
        
        async function placeOrder(paymentMethod) {
            const customerName = document.getElementById('customer-name').value.trim();
            const tableNumber = document.getElementById('table-number').value.trim();
            
            if (!customerName || !tableNumber) {
                showNotification("Nama dan nomor meja wajib diisi!", true); return;
            }

            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const tax = subtotal * 0.10;
            const total = subtotal + tax;
            const itemsForDB = cart.map(item => ({ name: item.name, qty: item.qty, price: item.price }));

            const newOrder = {
                customer: customerName, table: tableNumber, items: itemsForDB,
                subtotal, tax, total, status: 'pending', paymentMethod,
                createdAt: serverTimestamp()
            };

            try {
                const docRef = await addDoc(collection(db, 'orders'), newOrder);
                
                const waNumber = "6285349972513";
                let message = `*Pesanan Baru - Payboss Cafe*\n\n`;
                message += `ID Pesanan: ${docRef.id.substring(0, 5)}\n`;
                message += `Nama: *${customerName}*\nMeja: *${tableNumber}*\n\n*Item Pesanan:*\n`;
                itemsForDB.forEach(item => { message += `- ${item.name} (x${item.qty})\n`; });
                message += `\nSubtotal: Rp ${subtotal.toLocaleString('id-ID')}\n`;
                message += `Pajak (10%): Rp ${tax.toLocaleString('id-ID')}\n`;
                message += `Total: *Rp ${total.toLocaleString('id-ID')}*\n`;
                message += `Pembayaran: *${paymentMethod}*\n\n`;
                
                const successMsgContainer = document.getElementById('success-message');
                const waLink = document.getElementById('whatsapp-link');

                if (paymentMethod === 'QRIS') {
                    message += `_Mohon lampirkan bukti pembayaran Anda._`;
                    successMsgContainer.innerHTML = `<p>Pesanan Anda telah diterima! Silakan kirim detail pesanan ini beserta bukti bayar ke WhatsApp kasir.</p>`;
                    waLink.style.display = 'block';
                } else {
                    successMsgContainer.innerHTML = `<p>Pesanan Anda telah diterima! Silakan lakukan pembayaran di kasir dan tunjukkan ID Pesanan: <strong>${docRef.id.substring(0, 5)}</strong>.</p>`;
                    waLink.style.display = 'none';
                }

                waLink.href = `https://wa.me/${waNumber}?text=${encodeURIComponent(message)}`;
                
                cart = []; renderCart(); closeAllModals();
                document.getElementById('success-modal').classList.add('show');

            } catch (error) { showNotification("Gagal membuat pesanan!", true); }
        }

        document.body.addEventListener('click', function(e) {
            const addToCartBtn = e.target.closest('.order-btn[data-id]');
            if (addToCartBtn) addToCart(addToCartBtn.dataset.id);

            const quantityBtn = e.target.closest('.quantity-btn');
            if(quantityBtn) updateCartQuantity(quantityBtn.dataset.id, quantityBtn.dataset.action);

            // Ganti logika remove
            const removeBtn = e.target.closest('.remove-btn');
            if(removeBtn){
                const itemId = removeBtn.dataset.id;
                cart = cart.filter(item => item.id !== itemId);
                renderCart();
            }
        });

        document.getElementById('cart-fab').addEventListener('click', () => {
            renderCart(); document.getElementById('cart-modal').classList.add('show');
        });

        document.getElementById('checkout-btn').addEventListener('click', () => {
            if (cart.length === 0) { showNotification("Keranjang Anda kosong!", true); return; }
            if(!document.getElementById('customer-name').value || !document.getElementById('table-number').value){
                 showNotification("Nama dan Nomor Meja wajib diisi!", true); return;
            }
            closeAllModals(); document.getElementById('payment-modal').classList.add('show');
        });

        document.getElementById('pay-cash-btn').addEventListener('click', () => placeOrder('Bayar di Kasir'));
        document.getElementById('pay-qris-btn').addEventListener('click', () => {
            closeAllModals(); document.getElementById('qris-modal').classList.add('show');
        });
        document.getElementById('confirm-qris-payment-btn').addEventListener('click', () => placeOrder('QRIS'));

        function closeAllModals() { document.querySelectorAll('.modal-overlay').forEach(modal => modal.classList.remove('show')); }
        document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', closeAllModals));
        
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const target = this.dataset.tab;
                    tabButtons.forEach(b => b.classList.remove('active')); this.classList.add('active');
                    tabContents.forEach(c => c.classList.remove('active')); document.getElementById(target).classList.add('active');
                });
            });
        }

        function showNotification(message, isError = false) {
            const el = document.createElement('div');
            el.className = 'notification'; el.textContent = message;
            if (isError) el.style.backgroundColor = '#A52A2A';
            document.body.appendChild(el);
            setTimeout(() => el.classList.add('show'), 10);
            setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 500); }, 3000);
        }
        
        setupTabs();
    </script>
</body>
</html>

